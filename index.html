<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Notion HR ‚Äî Workspace</title>

  <!-- Manifest -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#10b981">

  <!-- Tailwind local first, CDN fallback -->
  <link rel="stylesheet" href="./assets/css/tailwind.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.10/dist/tailwind.min.css">

  <!-- Small custom styles to refine the minimal aesthetic -->
  <style>
    :root{
      --accent: #10b981;
      --muted: #6b7280;
      --card-bg: #ffffff;
      --surface: #f8fafc;
    }
    html,body,#app { height: 100%; }
    body { background: var(--surface); color: #0f172a; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    /* sidebar */
    .sidebar { width: 280px; background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(250,250,250,0.85)); backdrop-filter: blur(6px); border-right: 1px solid #e6edf3; }
    .logo { font-weight: 700; letter-spacing: -0.01em; color: var(--accent); }
    .workspace-btn.active { background: linear-gradient(90deg, rgba(16,185,129,0.08), rgba(79,70,229,0.03)); border-left: 3px solid var(--accent); }
    /* subtle scrollbar */
    .no-scrollbar::-webkit-scrollbar { width: 8px; height:8px; }
    .no-scrollbar::-webkit-scrollbar-thumb { background: rgba(15,23,42,0.08); border-radius: 6px; }
    /* content */
    .page { background: transparent; }
    .card { background: var(--card-bg); border: 1px solid #eef2f7; border-radius: 12px; box-shadow: 0 6px 16px rgba(15,23,42,0.04); }
    /* tabs */
    .tab-button.active { border-bottom: 2px solid var(--accent); color: var(--accent); }
    /* small helpers */
    .muted { color: var(--muted); font-size: .95rem; }
    .pill { padding: .25rem .5rem; border-radius: 9999px; font-size: .75rem; background: rgba(15,23,42,0.04); }
    /* responsive */
    @media (max-width: 900px) {
      .sidebar { position: fixed; left: 0; top: 0; bottom: 0; z-index: 40; transform: translateX(-110%); transition: transform .22s; }
      .sidebar.open { transform: translateX(0); }
      .content-overlay{ position: fixed; inset: 0; background: rgba(7,12,20,0.3); z-index: 30; }
    }
  </style>
</head>
<body>

<div id="app" class="flex h-screen">

  <!-- SIDEBAR -->
  <aside id="sidebar" class="sidebar p-5 flex flex-col space-y-4 h-full">
    <!-- top -->
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-br from-indigo-600 to-green-400 rounded-lg flex items-center justify-center text-white text-lg">N</div>
        <div>
          <div class="logo text-lg">Notion HR</div>
          <div class="text-xs muted">Workspace</div>
        </div>
      </div>

      <button id="sidebar-toggle" class="hidden md:inline-flex items-center justify-center w-8 h-8 rounded border text-sm muted">
        ‚úï
      </button>
    </div>

    <!-- user -->
    <button id="user-profile" class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50">
      <div class="w-10 h-10 rounded bg-gray-100 flex items-center justify-center text-xl">üßë‚Äçüíª</div>
      <div class="text-left">
        <div id="user-name-display" class="font-medium">Usuario local</div>
        <div id="user-branch-display" class="text-xs muted">Sucursal</div>
      </div>
    </button>

    <!-- workspaces -->
    <div class="flex-1 overflow-auto no-scrollbar">
      <div class="text-xs muted uppercase tracking-wide mb-2">Espacios</div>

      <div id="workspace-list" class="space-y-1">
        <!-- workspace buttons injected dynamically -->
        <!-- ejemplo:
        <button class="workspace-btn w-full text-left p-2 rounded-lg">Mi Espacio</button>
        -->
      </div>

      <div class="mt-4">
        <button id="add-workspace" class="w-full py-2 px-3 card text-sm font-medium">+ Nuevo espacio</button>
      </div>

      <hr class="my-4 border-t">

      <div id="injected-views-container" class="space-y-1">
        <!-- menuInject.js inyectar√° las vistas aqu√≠ -->
      </div>
    </div>

    <!-- footer -->
    <div class="text-xs muted">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <img src="./assets/icons/icon-32.png" alt="icon" class="w-6 h-6">
          <span>v1.0</span>
        </div>
        <button id="btn-export-gist" class="pill">Backup</button>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="flex-1 page p-6 overflow-auto">
    <div class="max-w-7xl mx-auto">

      <!-- Top controls (minimal): search + actions (moved inside main, not top nav) -->
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <button id="open-sidebar" class="md:hidden p-2 rounded-lg border">‚ò∞</button>
          <h1 id="current-workspace-title" class="text-2xl font-semibold">Cargando...</h1>
          <span class="pill" id="workspace-badge">Principal</span>
        </div>

        <div class="flex items-center gap-3">
          <input id="global-search" class="border rounded-lg p-2 text-sm w-64" placeholder="Buscar en workspace...">
          <button id="btn-new-item" class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-green-500 text-white rounded-lg shadow">+ Nuevo</button>
        </div>
      </div>

      <!-- Views Tabs -->
      <div id="view-tabs" class="flex items-center gap-2 mb-4">
        <!-- renderTabs() llenar√° esto -->
      </div>

      <!-- Content -->
      <section id="content-view" class="min-h-[70vh]">
        <!-- renderContent() pintar√° aqu√≠ -->
        <div class="card p-8">
          <h2 class="text-xl font-semibold">Bienvenido a Notion HR</h2>
          <p class="muted mt-2">Selecciona un espacio o crea uno nuevo para empezar.</p>
        </div>
      </section>

    </div>
  </div>

</div>

<!-- OPTIONAL: small overlay for mobile when sidebar opens -->
<div id="content-overlay" class="hidden"></div>

<!-- SCRIPTS: coloca tus m√≥dulos EXACTAMENTE en este orden -->
<!-- 1) Dexie (si sigues us√°ndolo) -->
<script src="./assets/js/dexie.min.js"></script>

<!-- 2) Propiedades y reglas -->
<script src="./assets/js/properties.js"></script>
<script src="./assets/js/rules.js"></script>

<!-- 3) Tu script principal (si lo mantienes separado) -->
<script src="./assets/js/views.js"></script>

<!-- 4) Vistas y m√≥dulos nuevos (agenda, kanban, menu inject, zoom) -->
<script src="./assets/js/agendaView.js"></script>
<script src="./assets/js/kanbanNative.js"></script>
<script src="./assets/js/menuInject.js"></script>
<script src="./assets/js/zoom.js"></script>

<!-- 5) (Opcional) db sqlite adapter - si migras -->
<!-- <script src="./assets/js/db-sqlite.js"></script> -->

<!-- SERVICE WORKER registration (al final) -->
<script>
  // Sidebar mobile toggle
  (function(){
    const open = document.getElementById('open-sidebar');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('content-overlay');
    const closeBtn = document.getElementById('sidebar-toggle');

    function showSidebar(){
      sidebar.classList.add('open');
      overlay.classList.remove('hidden');
      overlay.classList.add('content-overlay');
      overlay.style.zIndex = 30;
    }
    function hideSidebar(){
      sidebar.classList.remove('open');
      overlay.classList.add('hidden');
    }

    open?.addEventListener('click', showSidebar);
    closeBtn?.addEventListener('click', hideSidebar);
    overlay?.addEventListener('click', hideSidebar);

    // basic interactive placeholders to show state
    document.getElementById('add-workspace')?.addEventListener('click', () => {
      if(typeof addWorkspace === 'function') addWorkspace();
    });

    document.getElementById('btn-new-item')?.addEventListener('click', () => {
      if(typeof showItemModal === 'function') showItemModal();
    });

    // user profile button
    document.getElementById('user-profile')?.addEventListener('click', ()=> {
      if(typeof showUserModal === 'function') showUserModal();
    });

    // global search (simple)
    document.getElementById('global-search')?.addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      if(typeof state !== 'undefined' && Array.isArray(state.currentRecords)){
        // quick client-side filtering and highlight (if you want index)
        const found = state.currentRecords.filter(r => (r.title||'').toLowerCase().includes(q) || JSON.stringify(r.properties||{}).toLowerCase().includes(q));
        // simple rendering: if current view is table, re-render; else open panel with results
        if(state.currentView === 'tabla' && typeof renderTable === 'function'){
          // temporarily replace currentRecords for rendering
          const backup = state.currentRecords;
          state.currentRecords = found;
          renderTable();
          state.currentRecords = backup;
        }
      }
    });

    // export gist button
    document.getElementById('btn-export-gist')?.addEventListener('click', ()=> {
      if(typeof exportToGist === 'function') exportToGist();
      else alert('Funci√≥n de export a gist no configurada');
    });

  })();

  // register SW if available
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(console.error);
  }
</script>

</body>
</html>